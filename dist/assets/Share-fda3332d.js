import{u as ee,b as se}from"./vue-router-71f03589.js";import{_ as oe}from"./index-5b267a90.js";import{j as te,r,ag as c,aq as ae,o as a,c as d,a as s,Q as ne,F as M,V as _,U as v,O as m,P as I,u as O,T as U,S as y,bh as le,bf as ie}from"./@vue-7298a6f3.js";import"./element-plus-69c99c20.js";import"./aplayer-585df14e.js";import"./lodash-es-36eb724a.js";import"./@vueuse-896144d5.js";import"./@element-plus-925c7e21.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-32577819.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-9626137c.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-7cc3f4ab.js";import"./vue-cookies-fc2d14d9.js";import"./@highlightjs-600d0386.js";import"./highlight.js-6845818c.js";import"./axios-4a70c6fc.js";import"./docx-preview-a6045d14.js";import"./jszip-1f4bc9a3.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-4bdf9d28.js";import"./vue-d7dd0a62.js";import"./dplayer-d4a41b2a.js";import"./vue-clipboard3-69020072.js";import"./clipboard-0f4a3daa.js";const w=S=>(le("data-v-f4e3d7d9"),S=S(),ie(),S),re={class:"share"},ce=w(()=>s("span",{class:"iconfont icon-pan"},null,-1)),de=w(()=>s("span",{class:"name"},"TaoAi云盘",-1)),pe=[ce,de],ue={class:"share-body"},he={key:0,class:"loading"},fe={class:"share-panel"},_e={class:"share-user-info"},ve={class:"avatar"},me={class:"share-info"},ye={class:"user-info"},Se={class:"nick-name"},ge={class:"share-time"},ke={class:"file-name"},Ie={class:"share-op-btn"},we=w(()=>s("span",{class:"iconfont icon-cancel"},null,-1)),Ce=w(()=>s("span",{class:"iconfont icon-import"},null,-1)),be={class:"file-list"},Fe=["onMouseenter","onMouseleave"],Te=["title"],Ne=["onClick"],Re={class:"op"},De=["onClick"],Pe=["onClick"],Me={key:0},Oe={__name:"Share",setup(S){const{proxy:n}=te(),u=ee(),C=se(),p={getShareLoginInfo:"/showShare/getShareLoginInfo",loadFileList:"/showShare/loadFileList",createDownloadUrl:"/showShare/createDownloadUrl",download:"/api/showShare/download",cancelShare:"/share/cancelShare",saveShare:"/showShare/saveShare"},i=C.params.shareId,l=r({});(async()=>{let e=await n.Request({url:p.getShareLoginInfo,showLoading:!1,params:{shareId:i}});if(e){if(e.data==null){u.push("/shareCheck/"+i);return}l.value=e.data}})();const x=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],h=r({}),z={extHeight:80,selectType:"checkbox"},b=async()=>{let e={pageNo:h.value.pageNo,pageSize:h.value.pageSize,shareId:i,filePid:N.value.fileId},t=await n.Request({url:p.loadFileList,params:e});t&&(h.value=t.data)},L=e=>{h.value.list.forEach(t=>{t.showOp=!1}),e.showOp=!0},V=e=>{e.showOp=!1},f=r([]),q=e=>{f.value=[],e.forEach(t=>{f.value.push(t.fileId)})},N=r({fileId:0}),j=e=>{const{curFolder:t}=e;N.value=t,b()},R=r(),D=r(),$=e=>{if(e.folderType==1){D.value.openFolder(e);return}e.shareId=i,R.value.showPreview(e,2)},A=async e=>{let t=await n.Request({url:p.createDownloadUrl+"/"+i+"/"+e});t&&(window.location.href=p.download+"/"+t.data)},g=r(),F=[],B=()=>{if(f.value.length!=0){if(!n.VueCookies.get("userInfo")){u.push("/login?redirectUrl="+C.path);return}F.values=f.value,g.value.showFolderDialog()}},E=e=>{if(!n.VueCookies.get("userInfo")){u.push("/login?redirectUrl="+C.path);return}F.values=[e.fileId],g.value.showFolderDialog()},H=async e=>{await n.Request({url:p.saveShare,params:{shareId:i,shareFileIds:F.values.join(","),myFolderId:e}})&&(b(),n.Message.success("保存成功"),g.value.close())},Q=()=>{n.Confirm("你确定要取消分享吗？",async()=>{await n.Request({url:p.cancelShare,params:{shareIds:i}})&&(n.Message.success("取消分享成功"),u.push("/"))})},G=()=>{u.push("/")};return(e,t)=>{const J=c("Avatar"),P=c("el-button"),K=c("Navigation"),T=c("icon"),W=c("Table"),X=c("FolderSelect"),Y=c("Preview"),Z=ae("loading");return a(),d("div",re,[s("div",{class:"header"},[s("div",{class:"header-content"},[s("div",{class:"logo",onClick:G},pe)])]),s("div",ue,[Object.keys(l.value).length==0?ne((a(),d("div",he,null,512)),[[Z,Object.keys(l.value).length==0]]):(a(),d(M,{key:1},[s("div",fe,[s("div",_e,[s("div",ve,[_(J,{userId:l.value.userId,avatar:l.value.avatar,width:50},null,8,["userId","avatar"])]),s("div",me,[s("div",ye,[s("span",Se,v(l.value.nickName),1),s("span",ge,"分享于 "+v(l.value.shareTime),1)]),s("div",ke,"分享文件："+v(l.value.fileName),1)])]),s("div",Ie,[l.value.currentUser?(a(),m(P,{key:0,type:"primary",onClick:Q},{default:I(()=>[we,U("取消分享")]),_:1})):(a(),m(P,{key:1,type:"primary",disabled:f.value.length==0,onClick:B},{default:I(()=>[Ce,U("保存到我的网盘")]),_:1},8,["disabled"]))])]),_(K,{ref_key:"navigationRef",ref:D,onNavChange:j,shareId:O(i)},null,8,["shareId"]),s("div",be,[_(W,{columns:x,showPagination:!0,dataSource:h.value,fetch:b,initFetch:!1,options:z,showPageSize:!1,onRowSelected:q},{fileName:I(({row:o})=>[s("div",{class:"file-item",onMouseenter:k=>L(o),onMouseleave:k=>V(o)},[(o.fileType==3||o.fileType==1)&&o.status!==0?(a(),m(T,{key:0,cover:o.fileCover},null,8,["cover"])):(a(),d(M,{key:1},[o.folderType==0?(a(),m(T,{key:0,fileType:o.fileType},null,8,["fileType"])):y("",!0),o.folderType==1?(a(),m(T,{key:1,fileType:0})):y("",!0)],64)),s("span",{class:"file-name",title:o.fileName},[s("span",{onClick:k=>$(o)},v(o.fileName),9,Ne)],8,Te),s("span",Re,[o.folderType==0?(a(),d("span",{key:0,class:"iconfont icon-download",onClick:k=>A(o.fileId)},"下载",8,De)):y("",!0),o.showOp&&!l.value.currentUser?(a(),d("span",{key:1,class:"iconfont icon-import",onClick:k=>E(o)},"保存到我的网盘",8,Pe)):y("",!0)])],40,Fe)]),fileSize:I(({row:o})=>[o.fileSize?(a(),d("span",Me,v(O(n).Utils.size2Str(o.fileSize)),1)):y("",!0)]),_:1},8,["dataSource"])])],64)),_(X,{ref_key:"folderSelectRef",ref:g,onFolderSelect:H},null,512),_(Y,{ref_key:"previewRef",ref:R},null,512)])])}}},cs=oe(Oe,[["__scopeId","data-v-f4e3d7d9"]]);export{cs as default};
